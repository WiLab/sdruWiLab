<pre class="code">
<span class="srcline"><span class="lineno"><a href="136,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1324U3">recoveredMessage</span>] = PHYReceive(<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,2" id="srcline2">  2</a></span><span class="line">                <span class="var type1" id="S3T1401U6">ObjAGC</span>,<span class="keyword">...</span><span class="comment">           <span class="comment">%Objects</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,3" id="srcline3">  3</a></span><span class="line">                <span class="var type1" id="S4T1342U7">ObjSDRuReceiver</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,4" id="srcline4">  4</a></span><span class="line">                <span class="var type1" id="S5T1691U8">ObjDetect</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,5" id="srcline5">  5</a></span><span class="line">                <span class="var type1" id="S6T1476U9">ObjPreambleDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,6" id="srcline6">  6</a></span><span class="line">                <span class="var type1" id="S7T1477U10">ObjDataDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,7" id="srcline7">  7</a></span><span class="line">                <span class="var type1" id="S8T1105U11">estimate</span>,<span class="keyword">...</span><span class="comment">         <span class="comment">%Structs</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,8" id="srcline8">  8</a></span><span class="line">                <span class="var type1" id="S9T1323U12">rx</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,9" id="srcline9">  9</a></span><span class="line">                <span class="var type1" id="S10T1U13">timeoutDuration</span>,<span class="keyword">...</span><span class="comment">  <span class="comment">%Values/Vectors</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,10" id="srcline10"> 10</a></span><span class="line">                <span class="var type1" id="S11T764U14">messageBits</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,11" id="srcline11"> 11</a></span><span class="line">                )</span></span>
<span class="srcline"><span class="lineno"><a href="136,12" id="srcline12"> 12</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="136,13" id="srcline13"> 13</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="136,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%DEBUG</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T1:U11"><span class="var type1" id="S12T1U17">DebugFlag</span> = <span class="mxinfo" id="T1:U13">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%DEBUG</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo" id="T1:U14"><span class="mxinfo" id="T1:U15"><span class="var type1" id="S8T1105U22">estimate</span>.numProcessed</span> = <span class="mxinfo" id="T1:U17">0</span></span>; <span class="comment">% # correct frames found</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo" id="T1:U18"><span class="var type1" id="S13T1U27">lastFound</span> = <span class="mxinfo" id="T1:U20">-<span class="mxinfo" id="T1:U21">2</span></span></span>; <span class="comment">%Flag for found frame, used for dup check</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo" id="T1:U22"><span class="var type1" id="S14T1U32">numBuffersProcessed</span> = <span class="mxinfo" id="T1:U24">0</span></span>; <span class="comment">%Track received data, needed for separate indexing of processed and unprocessed data (processed==preamble found)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo" id="T1:U25"><span class="var type1" id="S15T1U36">numFrames</span> = <span class="mxinfo" id="T1:U27">1</span></span>;<span class="comment">% Frames to capture</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Message string holder</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,25" id="srcline25"> 25</a></span><span class="line">coder.varsize(<span class="string">'recoveredMessage'</span>, [1, 80], [0 1]);</span></span>
<span class="srcline"><span class="lineno"><a href="136,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T1324:U28"><span class="var type1" id="S2T1324U54">recoveredMessage</span> = <span class="mxinfo" id="T208:U30"><span class="string">''</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%% Process received data</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% Locate frames in buffer and compensate for channel affects</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,30" id="srcline30"> 30</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T2:U31"><span class="mxinfo" id="T1:U32"><span class="var type1" id="S8T1105U59">estimate</span>.numProcessed</span> &lt; <span class="var type1" id="S15T1U61">numFrames</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,31" id="srcline31"> 31</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,32" id="srcline32"> 32</a></span><span class="line">    <span class="comment">% Get data from USRP</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,33" id="srcline33"> 33</a></span><span class="line">    <span class="mxinfo" id="T1399:U35"><span class="var type1" id="S17T1399U64">buffer</span> = <span class="mxinfo" id="T1399:U37">step(<span class="var type1" id="S4T1342U67">ObjSDRuReceiver</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,34" id="srcline34"> 34</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T2:U39"><span class="mxinfo" id="T199:U40">sum(<span class="var type1" id="S17T1399U73">buffer</span>)</span>==<span class="mxinfo" id="T1:U42">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,35" id="srcline35"> 35</a></span><span class="line">        <span class="comment">% All zeros from radio (Bug?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,36" id="srcline36"> 36</a></span><span class="line">        <span class="keyword">if</span> <span class="var type1" id="S12T1U77">DebugFlag</span> ;fprintf(<span class="string">'All zeros (Bug?)\n'</span>);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,37" id="srcline37"> 37</a></span><span class="line">        <span class="keyword">continue</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,38" id="srcline38"> 38</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,39" id="srcline39"> 39</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,40" id="srcline40"> 40</a></span><span class="line">    <span class="comment">% Automatic Gain Control</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo" id="T1399:U44"><span class="var type1" id="S17T1399U85">buffer</span> = <span class="mxinfo" id="T1399:U46">step(<span class="var type1" id="S3T1401U88">ObjAGC</span>, <span class="var type1" id="S17T1399U89">buffer</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,42" id="srcline42"> 42</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,43" id="srcline43"> 43</a></span><span class="line">    <span class="comment">% Increment processed data index</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,44" id="srcline44"> 44</a></span><span class="line">    <span class="mxinfo" id="T1:U49"><span class="var type1" id="S14T1U92">numBuffersProcessed</span> = <span class="mxinfo" id="T1:U51"><span class="var type1" id="S14T1U94">numBuffersProcessed</span> + <span class="mxinfo" id="T1:U53">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,45" id="srcline45"> 45</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,46" id="srcline46"> 46</a></span><span class="line">    <span class="comment">%% Find preamble in buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,47" id="srcline47"> 47</a></span><span class="line">    <span class="mxinfo" id="T1:U54">[<span class="var type1" id="S8T1105U100">estimate</span>.delay, <span class="var type1" id="S8T1105U103">estimate</span>.numPeaks] = <span class="fcn" id="F2708N119:B106">locateOFDMFrame_sdr</span>( <span class="mxinfo" id="T1:U57"><span class="var type1" id="S9T1323U108">rx</span>.FFTLength</span>, <span class="mxinfo" id="T197:U59"><span class="var type1" id="S9T1323U111">rx</span>.shortPreambleOFDM</span>, <span class="var type1" id="S17T1399U113">buffer</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,48" id="srcline48"> 48</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,49" id="srcline49"> 49</a></span><span class="line">    <span class="comment">% Check if frame exists in correct location and whether it's duplicate</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,50" id="srcline50"> 50</a></span><span class="line">    <span class="mxinfo" id="T2:U62"><span class="var type1" id="S22T2U116">FrameFound</span> = <span class="mxinfo" id="T2:U64">(<span class="mxinfo" id="T2:U65">(<span class="mxinfo" id="T1:U66"><span class="mxinfo" id="T1:U67"><span class="var type1" id="S8T1105U124">estimate</span>.delay</span> + <span class="mxinfo" id="T1:U69"><span class="var type1" id="S9T1323U127">rx</span>.frameLength</span></span>) &lt; <span class="mxinfo" id="T1:U71">length(<span class="var type1" id="S17T1399U131">buffer</span>)</span></span> ) &amp;&amp;<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64"> </span></span><span class="comment"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64">%Check if full data frame exists in buffer</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64">        (<span class="mxinfo" id="T2:U73"><span class="mxinfo" id="T1:U74"><span class="var type1" id="S8T1105U135">estimate</span>.delay</span> &gt; <span class="mxinfo" id="T1:U76">-<span class="mxinfo" id="T1:U77">1</span></span></span> ) &amp;&amp;<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64"> </span></span><span class="comment"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64">%Check if preamble located</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T2:U62"><span class="mxinfo" id="T2:U64">        (<span class="mxinfo" id="T2:U78">(<span class="mxinfo" id="T1:U79"><span class="var type1" id="S14T1U143">numBuffersProcessed</span>-<span class="var type1" id="S13T1U144">lastFound</span></span>) &gt;= <span class="mxinfo" id="T1:U82">2</span></span> )</span></span>; <span class="comment">%Check if duplicate frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,53" id="srcline53"> 53</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,54" id="srcline54"> 54</a></span><span class="line">    <span class="comment">%% Recover found frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,55" id="srcline55"> 55</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S22T2U148">FrameFound</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,56" id="srcline56"> 56</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,57" id="srcline57"> 57</a></span><span class="line">        <span class="mxinfo" id="T1:U84"><span class="var type1" id="S13T1U151">lastFound</span> = <span class="var type1" id="S14T1U152">numBuffersProcessed</span></span>;<span class="comment">%Flag frame as found so duplicate frames are not processed</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,58" id="srcline58"> 58</a></span><span class="line">        <span class="mxinfo" id="T1:U87"><span class="mxinfo" id="T1:U88"><span class="var type1" id="S8T1105U156">estimate</span>.numProcessed</span> = <span class="mxinfo" id="T1:U90"><span class="mxinfo" id="T1:U91"><span class="var type1" id="S8T1105U160">estimate</span>.numProcessed</span> + <span class="mxinfo" id="T1:U93">1</span></span></span>;<span class="comment">%Increment processed found frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,59" id="srcline59"> 59</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,60" id="srcline60"> 60</a></span><span class="line">        <span class="comment">% Extract single frame from input buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,61" id="srcline61"> 61</a></span><span class="line">        <span class="mxinfo" id="T1108:U94"><span class="var type1" id="S24T1108U165">rFrame</span> = <span class="mxinfo" id="T1108:U96"><span class="var type1" id="S17T1399U167">buffer</span>(<span class="mxinfo" id="T183:U98"><span class="mxinfo" id="T1:U99"><span class="var type1" id="S8T1105U171">estimate</span>.delay + 1</span> : <span class="mxinfo" id="T1:U101"><span class="var type1" id="S8T1105U176">estimate</span>.delay + <span class="mxinfo" id="T1:U103"><span class="var type1" id="S9T1323U179">rx</span>.frameLength</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,62" id="srcline62"> 62</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,63" id="srcline63"> 63</a></span><span class="line">        <span class="comment">% Correct frequency offset</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T1108:U105">[ <span class="var type1" id="S25T1108U184">rFreqShifted</span>, <span class="var type1" id="S8T1105U185">estimate</span> ] = <span class="fcn" id="F2867N66:B187">coarseOFDMFreqEst_sdr</span>( <span class="var type1" id="S24T1108U188">rFrame</span>, <span class="var type1" id="S9T1323U189">rx</span>, <span class="var type1" id="S8T1105U190">estimate</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,65" id="srcline65"> 65</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,66" id="srcline66"> 66</a></span><span class="line">        <span class="comment">% Equalize</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo" id="T536:U111">[ <span class="var type1" id="S27T536U194">RPostEqualizer</span>, <span class="mxinfo" id="T1:U113"><span class="mxinfo" id="T1:U114">~</span></span>, <span class="var type1" id="S8T1105U196">estimate</span>] = <span class="fcn" id="F2924N106:B198">equalizeOFDM</span>( <span class="var type1" id="S25T1108U199">rFreqShifted</span>, <span class="var type1" id="S9T1323U200">rx</span>, <span class="var type1" id="S8T1105U201">estimate</span>, <span class="var type1" id="S6T1476U202">ObjPreambleDemod</span>, <span class="var type1" id="S7T1477U203">ObjDataDemod</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,68" id="srcline68"> 68</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,69" id="srcline69"> 69</a></span><span class="line">        <span class="comment">% Demod subcarriers</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,70" id="srcline70"> 70</a></span><span class="line">        <span class="mxinfo" id="T1:U121">[ <span class="mxinfo" id="T1:U122"><span class="mxinfo" id="T1:U123">~</span></span>, <span class="var type1" id="S8T1105U208">estimate</span>, <span class="var type1" id="S29T182U209">RHard</span> ] = <span class="fcn" id="F3559N102:B211">demodOFDMSubcarriers_sdr</span>( <span class="var type1" id="S27T536U212">RPostEqualizer</span>, <span class="var type1" id="S9T1323U213">rx</span>, <span class="var type1" id="S8T1105U214">estimate</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,71" id="srcline71"> 71</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,72" id="srcline72"> 72</a></span><span class="line">        <span class="comment">% Save for later decoding and CRC</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,73" id="srcline73"> 73</a></span><span class="line">        <span class="mxinfo" id="T764:U129"><span class="mxinfo" id="T764:U130"><span class="var type1" id="S11T764U218">messageBits</span>(<span class="mxinfo" id="T1:U132"><span class="var type1" id="S8T1105U220">estimate</span>.numProcessed</span>,:)</span> = <span class="var type1" id="S29T182U223">RHard</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,74" id="srcline74"> 74</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="136,75" id="srcline75"> 75</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,76" id="srcline76"> 76</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,77" id="srcline77"> 77</a></span><span class="line">    <span class="comment">%% Timeout</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,78" id="srcline78"> 78</a></span><span class="line">    <span class="comment">%fprintf('%f\n',numBuffersProcessed);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,79" id="srcline79"> 79</a></span><span class="line">    <span class="comment">%fprintf('%f\n',timeoutDuration);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,80" id="srcline80"> 80</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T2:U135"><span class="var type1" id="S14T1U227">numBuffersProcessed</span> &gt; <span class="var type1" id="S10T1U228">timeoutDuration</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,81" id="srcline81"> 81</a></span><span class="line">        <span class="keyword">if</span> <span class="var type1" id="S12T1U231">DebugFlag</span> ;fprintf(<span class="string">'PHY| Receiver timed out\n'</span>);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,82" id="srcline82"> 82</a></span><span class="line">        <span class="mxinfo" id="T1324:U139"><span class="var type1" id="S2T1324U238">recoveredMessage</span> = <span class="mxinfo" id="T152:U141"><span class="string">'Timeout'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,84" id="srcline84"> 84</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,85" id="srcline85"> 85</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,86" id="srcline86"> 86</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,87" id="srcline87"> 87</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%% Process Messages</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,90" id="srcline90"> 90</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S31T1U243">recMessage</span> = <span class="mxinfo" id="T1:U143">1</span>:<span class="mxinfo" id="T1:U144"><span class="var type1" id="S8T1105U247">estimate</span>.numProcessed</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,91" id="srcline91"> 91</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,92" id="srcline92"> 92</a></span><span class="line">    <span class="comment">% CRC Check</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,93" id="srcline93"> 93</a></span><span class="line">    <span class="mxinfo" id="T1752:U146">[<span class="var type1" id="S32T1752U252">msg</span>, <span class="var type1" id="S33T2U253">err</span>] = step(<span class="var type1" id="S5T1691U256">ObjDetect</span>, <span class="mxinfo" id="T182:U150"><span class="mxinfo" id="T183:U151"><span class="mxinfo" id="T764:U152"><span class="var type1" id="S11T764U260">messageBits</span>(<span class="var type1" id="S31T1U261">recMessage</span>,:)</span>.'</span>&gt;<span class="mxinfo" id="T1:U155">0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,94" id="srcline94"> 94</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="136,95" id="srcline95"> 95</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T2:U156">~<span class="var type1" id="S33T2U267">err</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,96" id="srcline96"> 96</a></span><span class="line">        <span class="comment">% Convert Bits to characters</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,97" id="srcline97"> 97</a></span><span class="line">        <span class="mxinfo" id="T220:U158"><span class="var type1" id="S34T220U270">message</span> = <span class="mxinfo" id="T220:U160">char(<span class="mxinfo" id="T764:U161"><span class="mxinfo" id="T183:U162"><span class="fcn" id="F3696N59:B275">OFDMbits2letters</span>(<span class="mxinfo" id="T1752:U163"><span class="var type1" id="S32T1752U277">msg</span> &gt; <span class="mxinfo" id="T1:U165">0</span></span>)</span>.'</span>)</span></span>;<span class="comment">%messageBits(recMessage,1:end-3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,98" id="srcline98"> 98</a></span><span class="line">        <span class="comment">%Remove padding</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,99" id="srcline99"> 99</a></span><span class="line">        <span class="mxinfo" id="T764:U166"><span class="var type1" id="S37T764U281">messageEnd</span> = <span class="mxinfo" id="T764:U168">strfind(<span class="var type1" id="S34T220U284">message</span>,<span class="string">'EOF'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,100" id="srcline100">100</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T2:U170">~<span class="mxinfo" id="T2:U171">isempty(<span class="var type1" id="S37T764U291">messageEnd</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="136,101" id="srcline101">101</a></span><span class="line">            <span class="mxinfo" id="T1324:U173"><span class="var type1" id="S2T1324U294">recoveredMessage</span> = <span class="mxinfo" id="T220:U175"><span class="var type1" id="S34T220U296">message</span>(<span class="mxinfo" id="T1:U177">1</span>:<span class="mxinfo" id="T1:U178"><span class="mxinfo" id="T1:U179"><span class="var type1" id="S37T764U301">messageEnd</span>(<span class="mxinfo" id="T1:U181">1</span>,<span class="mxinfo" id="T1:U182">1</span>)</span>-<span class="mxinfo" id="T1:U183">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,102" id="srcline102">102</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S12T1U307">DebugFlag</span> ;fprintf(<span class="string">'PHY| Message recovered: %s\n'</span>,<span class="var type0" id="S2T0U312">recoveredMessage</span>); <span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,103" id="srcline103">103</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,105" id="srcline105">105</a></span><span class="line">        <span class="keyword">if</span> <span class="var type1" id="S12T1U316">DebugFlag</span> ;fprintf(<span class="string">'PHY| CRC Message Failure\n'</span>);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,106" id="srcline106">106</a></span><span class="line">        <span class="comment">%recoveredMessage = char(OFDMbits2letters(msg &gt; 0).');%messageBits(recMessage,1:end-3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,107" id="srcline107">107</a></span><span class="line">        <span class="comment">%fprintf('Corrupted Message: %s\n',recoveredMessage);</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,108" id="srcline108">108</a></span><span class="line">        <span class="mxinfo" id="T1324:U186"><span class="var type1" id="S2T1324U323">recoveredMessage</span> = <span class="mxinfo" id="T87:U188"><span class="string">'CRC Error'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="136,109" id="srcline109">109</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,110" id="srcline110">110</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="136,111" id="srcline111">111</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="136,112" id="srcline112">112</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
