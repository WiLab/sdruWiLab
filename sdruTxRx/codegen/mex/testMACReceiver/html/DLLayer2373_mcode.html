<pre class="code">
<span class="srcline"><span class="lineno"><a href="133,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1325U3">Response</span>, <span class="var type1" id="S3T220U4">previousMessage</span>, <span class="var type1" id="S4T1U5">originNodeID</span>, <span class="var type1" id="S5T1U6">destNodeID</span> ] = DLLayer(<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,2" id="srcline2">  2</a></span><span class="line">    <span class="var type1" id="S6T1338U9">ObjAGC</span>,<span class="keyword">...</span><span class="comment">           <span class="comment">%Objects</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,3" id="srcline3">  3</a></span><span class="line">    <span class="var type1" id="S7T1339U10">ObjSDRuReceiver</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,4" id="srcline4">  4</a></span><span class="line">    <span class="var type1" id="S8T1340U11">ObjDetect</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,5" id="srcline5">  5</a></span><span class="line">    <span class="var type1" id="S9T1341U12">ObjPreambleDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,6" id="srcline6">  6</a></span><span class="line">    <span class="var type1" id="S10T1342U13">ObjDataDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,7" id="srcline7">  7</a></span><span class="line">    <span class="var type1" id="S11T1106U14">estimate</span>,<span class="keyword">...</span><span class="comment">         <span class="comment">%Structs</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,8" id="srcline8">  8</a></span><span class="line">    <span class="var type1" id="S12T1324U15">tx</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,9" id="srcline9">  9</a></span><span class="line">    <span class="var type1" id="S13T1U16">timeoutDuration</span>,<span class="keyword">...</span><span class="comment">  <span class="comment">%Values/Vectors</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,10" id="srcline10"> 10</a></span><span class="line">    <span class="var type1" id="S14T766U17">messageBits</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,11" id="srcline11"> 11</a></span><span class="line">    <span class="mxinfo" id="T220:U14"><span class="mxinfo" id="T220:U15"><span class="var type1" id="S3T220U18">previousMessage</span></span></span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,12" id="srcline12"> 12</a></span><span class="line">    )</span></span>
<span class="srcline"><span class="lineno"><a href="133,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T1:U17"><span class="var type1" id="S15T1U21">DebugFlag</span> = <span class="mxinfo" id="T1:U19">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo" id="T1:U20"><span class="var type1" id="S4T1U25">originNodeID</span> = <span class="mxinfo" id="T1:U22">-<span class="mxinfo" id="T1:U23">1</span></span></span>; <span class="comment">%Initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo" id="T1:U24"><span class="var type1" id="S5T1U30">destNodeID</span> = <span class="mxinfo" id="T1:U26">-<span class="mxinfo" id="T1:U27">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,19" id="srcline19"> 19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% 0 = Call PHY Receiver</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% 1 = Timeout</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% 2 = Corrupt Message</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% 3 = Message Reception Successfull</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Duplicates are checked at the last stage</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo" id="T1:U28"><span class="var type1" id="S16T1U35">state</span> = <span class="mxinfo" id="T1:U30">0</span></span>;<span class="comment">% Initial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T1:U31"><span class="var type1" id="S17T1U39">timeouts</span> = <span class="mxinfo" id="T1:U33">0</span></span>; <span class="comment">% Counter</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T1:U34"><span class="var type1" id="S18T1U43">maxTimeouts</span> = <span class="mxinfo" id="T1:U36">10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% Message string holder</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,30" id="srcline30"> 30</a></span><span class="line">coder.varsize(<span class="string">'Response'</span>, [1, 80], [0 1]);</span></span>
<span class="srcline"><span class="lineno"><a href="133,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo" id="T1325:U37"><span class="var type1" id="S2T1325U61">Response</span> = <span class="mxinfo" id="T208:U39"><span class="string">''</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% Run system</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,34" id="srcline34"> 34</a></span><span class="line"><span class="keyword">while</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="133,35" id="srcline35"> 35</a></span><span class="line">    <span class="comment">%% Process Messages</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,36" id="srcline36"> 36</a></span><span class="line">    <span class="keyword">switch</span> <span class="var type1" id="S16T1U66">state</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,37" id="srcline37"> 37</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="133,38" id="srcline38"> 38</a></span><span class="line">        <span class="comment">%Wait for message</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,39" id="srcline39"> 39</a></span><span class="line">        <span class="keyword">case</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="133,40" id="srcline40"> 40</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U41"><span class="var type1" id="S17T1U72">timeouts</span> &gt; <span class="var type1" id="S18T1U73">maxTimeouts</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,41" id="srcline41"> 41</a></span><span class="line">                <span class="keyword">if</span> <span class="var type1" id="S15T1U76">DebugFlag</span>;fprintf(<span class="string">'DL| Max timeouts reached\n'</span>);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,42" id="srcline42"> 42</a></span><span class="line">                <span class="mxinfo" id="T1325:U45"><span class="var type1" id="S2T1325U83">Response</span> = <span class="mxinfo" id="T152:U47"><span class="string">'Timeout'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,43" id="srcline43"> 43</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,44" id="srcline44"> 44</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,45" id="srcline45"> 45</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,46" id="srcline46"> 46</a></span><span class="line">            <span class="comment">% Call Physical Layer</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,47" id="srcline47"> 47</a></span><span class="line">            <span class="mxinfo" id="T1325:U48"><span class="var type1" id="S2T1325U88">Response</span> = <span class="mxinfo" id="T1325:U50"><span class="fcn" id="F2401N58:B90">PHYReceive</span>(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S6T1338U91">ObjAGC</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">           </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Objects</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S7T1339U92">ObjSDRuReceiver</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S8T1340U93">ObjDetect</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S9T1341U94">ObjPreambleDemod</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S10T1342U95">ObjDataDemod</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S11T1106U96">estimate</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">         </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Structs</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S12T1324U97">tx</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S13T1U98">timeoutDuration</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">  </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Values/Vectors</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S14T766U99">messageBits</span><span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,58" id="srcline58"> 58</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,59" id="srcline59"> 59</a></span><span class="line">            <span class="comment">% Choose next state</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,60" id="srcline60"> 60</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U102">DebugFlag</span>;fprintf(<span class="string">'DL| Message=|%s|\n'</span>,<span class="mxinfo" id="T220:U61"><span class="var type1" id="S2T1325U108">Response</span>(<span class="mxinfo" id="T1:U63">1</span>:<span class="mxinfo" id="T1:U64"><span class="mxinfo" id="T1:U65">end</span>-<span class="mxinfo" id="T1:U66">1</span></span>)</span>);<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,61" id="srcline61"> 61</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U67">strcmp(<span class="var type1" id="S2T1325U119">Response</span>, <span class="string">'Timeout'</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,62" id="srcline62"> 62</a></span><span class="line">                <span class="mxinfo" id="T1:U69"><span class="var type1" id="S16T1U123">state</span> = <span class="mxinfo" id="T1:U71">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,63" id="srcline63"> 63</a></span><span class="line">            <span class="keyword">elseif</span> <span class="mxinfo" id="T2:U72">strcmp(<span class="var type1" id="S2T1325U129">Response</span>,<span class="string">'CRC Error'</span>)</span> || <span class="mxinfo" id="T2:U74">isempty(<span class="var type1" id="S2T1325U133">Response</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,64" id="srcline64"> 64</a></span><span class="line">                <span class="mxinfo" id="T1:U76"><span class="var type1" id="S16T1U136">state</span> = <span class="mxinfo" id="T1:U78">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,65" id="srcline65"> 65</a></span><span class="line">            <span class="keyword">else</span><span class="comment">% Successfully decoded</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,66" id="srcline66"> 66</a></span><span class="line">                <span class="mxinfo" id="T1:U79"><span class="var type1" id="S16T1U141">state</span> = <span class="mxinfo" id="T1:U81">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,67" id="srcline67"> 67</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,68" id="srcline68"> 68</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="133,69" id="srcline69"> 69</a></span><span class="line">        <span class="comment">% Timeout occured    </span></span></span>
<span class="srcline"><span class="lineno"><a href="133,70" id="srcline70"> 70</a></span><span class="line">        <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="133,71" id="srcline71"> 71</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U147">DebugFlag</span>;fprintf(<span class="string">'DL| Timeout occured\n'</span>);<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,72" id="srcline72"> 72</a></span><span class="line">            <span class="mxinfo" id="T1:U83"><span class="var type1" id="S17T1U154">timeouts</span> = <span class="mxinfo" id="T1:U85"><span class="var type1" id="S17T1U156">timeouts</span> + <span class="mxinfo" id="T1:U87">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,73" id="srcline73"> 73</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U88"><span class="var type1" id="S17T1U161">timeouts</span> &gt; <span class="var type1" id="S18T1U162">maxTimeouts</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,74" id="srcline74"> 74</a></span><span class="line">                <span class="comment">%if DebugFlag;fprintf('DL| Max timeouts reached\n');end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,75" id="srcline75"> 75</a></span><span class="line">                fprintf(<span class="string">'DL| Max timeouts reached\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="133,76" id="srcline76"> 76</a></span><span class="line">                <span class="mxinfo" id="T1325:U91"><span class="var type1" id="S2T1325U169">Response</span> = <span class="mxinfo" id="T152:U93"><span class="string">'Timeout'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,77" id="srcline77"> 77</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,78" id="srcline78"> 78</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,79" id="srcline79"> 79</a></span><span class="line">            <span class="mxinfo" id="T1:U94"><span class="var type1" id="S16T1U174">state</span> = <span class="mxinfo" id="T1:U96">0</span></span>;<span class="comment">%Get another message</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,80" id="srcline80"> 80</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,81" id="srcline81"> 81</a></span><span class="line">        <span class="comment">% Message corrupted    </span></span></span>
<span class="srcline"><span class="lineno"><a href="133,82" id="srcline82"> 82</a></span><span class="line">        <span class="keyword">case</span> 2</span></span>
<span class="srcline"><span class="lineno"><a href="133,83" id="srcline83"> 83</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U180">DebugFlag</span>;fprintf(<span class="string">'DL| Message corrupted\n'</span>);<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,84" id="srcline84"> 84</a></span><span class="line">            <span class="mxinfo" id="T1:U98"><span class="var type1" id="S17T1U187">timeouts</span> = <span class="mxinfo" id="T1:U100"><span class="var type1" id="S17T1U189">timeouts</span> + <span class="mxinfo" id="T1:U102">0.01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo" id="T1:U103"><span class="var type1" id="S16T1U193">state</span> = <span class="mxinfo" id="T1:U105">0</span></span>;<span class="comment">%Get another message</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,86" id="srcline86"> 86</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,87" id="srcline87"> 87</a></span><span class="line">        <span class="comment">% Default: Message successfully received    </span></span></span>
<span class="srcline"><span class="lineno"><a href="133,88" id="srcline88"> 88</a></span><span class="line">        <span class="keyword">case</span> 3<span class="comment">%otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,89" id="srcline89"> 89</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,90" id="srcline90"> 90</a></span><span class="line">            <span class="comment">%disp(['DL| MSG: ',Response])</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,91" id="srcline91"> 91</a></span><span class="line">            <span class="comment">%disp(['DL| Timeouts: ',num2str(timeouts)])</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,92" id="srcline92"> 92</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,93" id="srcline93"> 93</a></span><span class="line">            <span class="comment">% Final Duplication check</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,94" id="srcline94"> 94</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U106">strcmp(<span class="var type1" id="S3T220U201">previousMessage</span>, <span class="var type1" id="S2T1325U202">Response</span>)</span><span class="comment">%Dupe</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,95" id="srcline95"> 95</a></span><span class="line">                <span class="comment">%if DebugFlag;fprintf('DL| Duplicate Message\n');end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,96" id="srcline96"> 96</a></span><span class="line">                fprintf(<span class="string">'DL| Duplicate Message\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="133,97" id="srcline97"> 97</a></span><span class="line">                <span class="mxinfo" id="T220:U109"><span class="var type1" id="S3T220U209">previousMessage</span> = <span class="var type1" id="S2T1325U210">Response</span></span>;<span class="comment">%Update history for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,98" id="srcline98"> 98</a></span><span class="line">                <span class="mxinfo" id="T1:U112"><span class="var type1" id="S4T1U213">originNodeID</span> = <span class="mxinfo" id="T1:U114"><span class="mxinfo" id="T1:U115">double(<span class="mxinfo" id="T13:U116"><span class="var type1" id="S2T1325U218">Response</span>(<span class="mxinfo" id="T1:U118"><span class="mxinfo" id="T1:U119">end</span>-<span class="mxinfo" id="T1:U120">2</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U121">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,99" id="srcline99"> 99</a></span><span class="line">                <span class="mxinfo" id="T1:U122"><span class="var type1" id="S5T1U226">destNodeID</span> = <span class="mxinfo" id="T1:U124"><span class="mxinfo" id="T1:U125">double(<span class="mxinfo" id="T13:U126"><span class="var type1" id="S2T1325U231">Response</span>(<span class="mxinfo" id="T1:U128"><span class="mxinfo" id="T1:U129">end</span>-<span class="mxinfo" id="T1:U130">1</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U131">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,100" id="srcline100">100</a></span><span class="line">                <span class="mxinfo" id="T1325:U132"><span class="var type1" id="S2T1325U239">Response</span> = <span class="mxinfo" id="T87:U134"><span class="string">'Duplicate'</span></span></span>;<span class="comment">%Tell upper layers duplicate</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,101" id="srcline101">101</a></span><span class="line">            <span class="keyword">else</span><span class="comment">%No Dupe</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,102" id="srcline102">102</a></span><span class="line">                <span class="mxinfo" id="T220:U135"><span class="var type1" id="S3T220U244">previousMessage</span> = <span class="var type1" id="S2T1325U245">Response</span></span>;<span class="comment">%Update history for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,103" id="srcline103">103</a></span><span class="line">                <span class="mxinfo" id="T1:U138"><span class="var type1" id="S4T1U248">originNodeID</span> = <span class="mxinfo" id="T1:U140"><span class="mxinfo" id="T1:U141">double(<span class="mxinfo" id="T13:U142"><span class="var type1" id="S2T1325U253">Response</span>(<span class="mxinfo" id="T1:U144"><span class="mxinfo" id="T1:U145">end</span>-<span class="mxinfo" id="T1:U146">2</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U147">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,104" id="srcline104">104</a></span><span class="line">                <span class="mxinfo" id="T1:U148"><span class="var type1" id="S5T1U261">destNodeID</span> = <span class="mxinfo" id="T1:U150"><span class="mxinfo" id="T1:U151">double(<span class="mxinfo" id="T13:U152"><span class="var type1" id="S2T1325U266">Response</span>(<span class="mxinfo" id="T1:U154"><span class="mxinfo" id="T1:U155">end</span>-<span class="mxinfo" id="T1:U156">1</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U157">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,105" id="srcline105">105</a></span><span class="line">                <span class="mxinfo" id="T1325:U158"><span class="var type1" id="S2T1325U274">Response</span> = <span class="mxinfo" id="T220:U160"><span class="var type1" id="S2T1325U276">Response</span>(<span class="mxinfo" id="T1:U162">1</span>:<span class="mxinfo" id="T1:U163"><span class="mxinfo" id="T1:U164">end</span>-<span class="mxinfo" id="T1:U165">3</span></span>)</span></span>;<span class="comment">%Remove identifer key and nodeIDs</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,107" id="srcline107">107</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,108" id="srcline108">108</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="133,109" id="srcline109">109</a></span><span class="line">            <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="133,110" id="srcline110">110</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,111" id="srcline111">111</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="133,112" id="srcline112">112</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,113" id="srcline113">113</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,114" id="srcline114">114</a></span><span class="line"><span class="comment">% Final check</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,115" id="srcline115">115</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T2:U166"><span class="mxinfo" id="T1:U167">abs(<span class="var type1" id="S5T1U289">destNodeID</span>)</span> &gt; <span class="mxinfo" id="T1:U169">length(<span class="var type1" id="S12T1324U293">tx</span>.offsetTable)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="133,116" id="srcline116">116</a></span><span class="line">    <span class="mxinfo" id="T1:U171"><span class="var type1" id="S5T1U297">destNodeID</span>=<span class="mxinfo" id="T1:U173"><span class="var type1" id="S12T1324U299">tx</span>.nodeNum</span></span>;<span class="comment">% Something went wrong, probably corrupt message, reset to self</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,117" id="srcline117">117</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="133,121" id="srcline121">121</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="133,122" id="srcline122">122</a></span><span class="line"></span></span>
</pre>
