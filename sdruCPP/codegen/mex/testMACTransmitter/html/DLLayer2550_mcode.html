<pre class="code">
<span class="srcline"><span class="lineno"><a href="147,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T1325U3">Response</span>, <span class="var type1" id="S3T220U4">previousMessage</span>, <span class="var type1" id="S4T1U5">originNodeID</span>, <span class="var type1" id="S5T1U6">destNodeID</span> ] = DLLayer(<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,2" id="srcline2">  2</a></span><span class="line">    <span class="var type1" id="S6T1409U9">ObjAGC</span>,<span class="keyword">...</span><span class="comment">           <span class="comment">%Objects</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,3" id="srcline3">  3</a></span><span class="line">    <span class="var type1" id="S7T1410U10">ObjSDRuReceiver</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,4" id="srcline4">  4</a></span><span class="line">    <span class="var type1" id="S8T1411U11">ObjDetect</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,5" id="srcline5">  5</a></span><span class="line">    <span class="var type1" id="S9T1412U12">ObjPreambleDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,6" id="srcline6">  6</a></span><span class="line">    <span class="var type1" id="S10T1413U13">ObjDataDemod</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,7" id="srcline7">  7</a></span><span class="line">    <span class="var type1" id="S11T1106U14">estimate</span>,<span class="keyword">...</span><span class="comment">         <span class="comment">%Structs</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,8" id="srcline8">  8</a></span><span class="line">    <span class="var type1" id="S12T1324U15">tx</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,9" id="srcline9">  9</a></span><span class="line">    <span class="var type1" id="S13T1U16">timeoutDuration</span>,<span class="keyword">...</span><span class="comment">  <span class="comment">%Values/Vectors</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,10" id="srcline10"> 10</a></span><span class="line">    <span class="var type1" id="S14T766U17">messageBits</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,11" id="srcline11"> 11</a></span><span class="line">    <span class="mxinfo" id="T220:U14"><span class="mxinfo" id="T220:U15"><span class="var type1" id="S3T220U18">previousMessage</span></span></span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,12" id="srcline12"> 12</a></span><span class="line">    )</span></span>
<span class="srcline"><span class="lineno"><a href="147,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T1:U17"><span class="var type1" id="S15T1U21">DebugFlag</span> = <span class="mxinfo" id="T1:U19">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%Initialize values</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo" id="T1:U20"><span class="var type1" id="S4T1U25">originNodeID</span> = <span class="mxinfo" id="T1:U22">-<span class="mxinfo" id="T1:U23">1</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="147,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo" id="T1:U24"><span class="var type1" id="S5T1U30">destNodeID</span> = <span class="mxinfo" id="T1:U26">-<span class="mxinfo" id="T1:U27">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% 0 = Call PHY Receiver</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% 1 = Timeout</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% 2 = Corrupt Message</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% 3 = Message Reception Successfull</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% Duplicates are checked at the last stage</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T1:U28"><span class="var type1" id="S16T1U35">state</span> = <span class="mxinfo" id="T1:U30">0</span></span>;<span class="comment">% Initial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T1:U31"><span class="var type1" id="S17T1U39">timeouts</span> = <span class="mxinfo" id="T1:U33">0</span></span>; <span class="comment">% Counter</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T1:U34"><span class="var type1" id="S18T1U43">maxTimeouts</span> = <span class="mxinfo" id="T1:U36">10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% Message string holder</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,31" id="srcline31"> 31</a></span><span class="line">coder.varsize(<span class="string">'Response'</span>, [1, 80], [0 1]);</span></span>
<span class="srcline"><span class="lineno"><a href="147,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo" id="T1325:U37"><span class="var type1" id="S2T1325U61">Response</span> = <span class="mxinfo" id="T208:U39"><span class="string">''</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Run system</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,35" id="srcline35"> 35</a></span><span class="line"><span class="keyword">while</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="147,36" id="srcline36"> 36</a></span><span class="line">    <span class="comment">%% Process Messages</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,37" id="srcline37"> 37</a></span><span class="line">    <span class="keyword">switch</span> <span class="var type1" id="S16T1U66">state</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,38" id="srcline38"> 38</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="147,39" id="srcline39"> 39</a></span><span class="line">        <span class="comment">%Wait for message</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,40" id="srcline40"> 40</a></span><span class="line">        <span class="keyword">case</span> 0</span></span>
<span class="srcline"><span class="lineno"><a href="147,41" id="srcline41"> 41</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U41"><span class="var type1" id="S17T1U72">timeouts</span> &gt; <span class="var type1" id="S18T1U73">maxTimeouts</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,42" id="srcline42"> 42</a></span><span class="line">                <span class="keyword">if</span> <span class="var type1" id="S15T1U76">DebugFlag</span>;fprintf(<span class="string">'DL| Max timeouts reached\n'</span>);<span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,43" id="srcline43"> 43</a></span><span class="line">                <span class="mxinfo" id="T1325:U45"><span class="var type1" id="S2T1325U83">Response</span> = <span class="mxinfo" id="T152:U47"><span class="string">'Timeout'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,44" id="srcline44"> 44</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,45" id="srcline45"> 45</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,46" id="srcline46"> 46</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,47" id="srcline47"> 47</a></span><span class="line">            <span class="comment">% Call Physical Layer</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,48" id="srcline48"> 48</a></span><span class="line">            <span class="mxinfo" id="T1325:U48"><span class="var type1" id="S2T1325U88">Response</span> = <span class="mxinfo" id="T1325:U50"><span class="fcn" id="F2560N59:B90">PHYReceive</span>(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S6T1409U91">ObjAGC</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">           </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Objects</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S7T1410U92">ObjSDRuReceiver</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S8T1411U93">ObjDetect</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S9T1412U94">ObjPreambleDemod</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S10T1413U95">ObjDataDemod</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S11T1106U96">estimate</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">         </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Structs</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S12T1324U97">tx</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S13T1U98">timeoutDuration</span>,<span class="keyword">...</span></span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">  </span></span><span class="comment"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">%Values/Vectors</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                <span class="var type1" id="S14T766U99">messageBits</span><span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo" id="T1325:U48"><span class="mxinfo" id="T1325:U50">                )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,59" id="srcline59"> 59</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,60" id="srcline60"> 60</a></span><span class="line">            <span class="comment">% Choose next state</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,61" id="srcline61"> 61</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U102">DebugFlag</span>;fprintf(<span class="string">'DL| Message=|%s|\n'</span>,<span class="var type0" id="S2T0U108">Response</span>(1:end));<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,62" id="srcline62"> 62</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U61">strcmp(<span class="var type1" id="S2T1325U117">Response</span>, <span class="string">'Timeout'</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,63" id="srcline63"> 63</a></span><span class="line">                <span class="mxinfo" id="T1:U63"><span class="var type1" id="S16T1U121">state</span> = <span class="mxinfo" id="T1:U65">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,64" id="srcline64"> 64</a></span><span class="line">            <span class="keyword">elseif</span> <span class="mxinfo" id="T2:U66">strcmp(<span class="var type1" id="S2T1325U127">Response</span>,<span class="string">'CRC Error'</span>)</span> || <span class="mxinfo" id="T2:U68">isempty(<span class="var type1" id="S2T1325U131">Response</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,65" id="srcline65"> 65</a></span><span class="line">                <span class="mxinfo" id="T1:U70"><span class="var type1" id="S16T1U134">state</span> = <span class="mxinfo" id="T1:U72">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,66" id="srcline66"> 66</a></span><span class="line">            <span class="keyword">else</span><span class="comment">% Successfully decoded</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,67" id="srcline67"> 67</a></span><span class="line">                <span class="mxinfo" id="T1:U73"><span class="var type1" id="S16T1U139">state</span> = <span class="mxinfo" id="T1:U75">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,68" id="srcline68"> 68</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,69" id="srcline69"> 69</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="147,70" id="srcline70"> 70</a></span><span class="line">        <span class="comment">% Timeout occured    </span></span></span>
<span class="srcline"><span class="lineno"><a href="147,71" id="srcline71"> 71</a></span><span class="line">        <span class="keyword">case</span> 1</span></span>
<span class="srcline"><span class="lineno"><a href="147,72" id="srcline72"> 72</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U145">DebugFlag</span>;fprintf(<span class="string">'DL| Timeout occured\n'</span>);<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,73" id="srcline73"> 73</a></span><span class="line">            <span class="mxinfo" id="T1:U77"><span class="var type1" id="S17T1U152">timeouts</span> = <span class="mxinfo" id="T1:U79"><span class="var type1" id="S17T1U154">timeouts</span> + <span class="mxinfo" id="T1:U81">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,74" id="srcline74"> 74</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U82"><span class="var type1" id="S17T1U159">timeouts</span> &gt; <span class="var type1" id="S18T1U160">maxTimeouts</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,75" id="srcline75"> 75</a></span><span class="line">                <span class="comment">%if DebugFlag;fprintf('DL| Max timeouts reached\n');end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,76" id="srcline76"> 76</a></span><span class="line">                fprintf(<span class="string">'DL| Max timeouts reached\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="147,77" id="srcline77"> 77</a></span><span class="line">                <span class="mxinfo" id="T1325:U85"><span class="var type1" id="S2T1325U167">Response</span> = <span class="mxinfo" id="T152:U87"><span class="string">'Timeout'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,78" id="srcline78"> 78</a></span><span class="line">                <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,79" id="srcline79"> 79</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,80" id="srcline80"> 80</a></span><span class="line">            <span class="mxinfo" id="T1:U88"><span class="var type1" id="S16T1U172">state</span> = <span class="mxinfo" id="T1:U90">0</span></span>;<span class="comment">%Get another message</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,81" id="srcline81"> 81</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,82" id="srcline82"> 82</a></span><span class="line">        <span class="comment">% Message corrupted    </span></span></span>
<span class="srcline"><span class="lineno"><a href="147,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">case</span> 2</span></span>
<span class="srcline"><span class="lineno"><a href="147,84" id="srcline84"> 84</a></span><span class="line">            <span class="keyword">if</span> <span class="var type1" id="S15T1U178">DebugFlag</span>;fprintf(<span class="string">'DL| Message corrupted\n'</span>);<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo" id="T1:U92"><span class="var type1" id="S17T1U185">timeouts</span> = <span class="mxinfo" id="T1:U94"><span class="var type1" id="S17T1U187">timeouts</span> + <span class="mxinfo" id="T1:U96">0.01</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo" id="T1:U97"><span class="var type1" id="S16T1U191">state</span> = <span class="mxinfo" id="T1:U99">0</span></span>;<span class="comment">%Get another message</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,87" id="srcline87"> 87</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,88" id="srcline88"> 88</a></span><span class="line">        <span class="comment">% Default: Message successfully received    </span></span></span>
<span class="srcline"><span class="lineno"><a href="147,89" id="srcline89"> 89</a></span><span class="line">        <span class="keyword">case</span> 3<span class="comment">%otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,90" id="srcline90"> 90</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,91" id="srcline91"> 91</a></span><span class="line">            <span class="comment">%disp(['DL| MSG: ',Response])</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,92" id="srcline92"> 92</a></span><span class="line">            <span class="comment">%disp(['DL| Timeouts: ',num2str(timeouts)])</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,93" id="srcline93"> 93</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,94" id="srcline94"> 94</a></span><span class="line">            <span class="comment">% Final Duplication check</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,95" id="srcline95"> 95</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T2:U100">strcmp(<span class="var type1" id="S3T220U199">previousMessage</span>, <span class="var type1" id="S2T1325U200">Response</span>)</span><span class="comment">%Dupe</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,96" id="srcline96"> 96</a></span><span class="line">                <span class="comment">%if DebugFlag;fprintf('DL| Duplicate Message\n');end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,97" id="srcline97"> 97</a></span><span class="line">                fprintf(<span class="string">'DL| Duplicate Message\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="147,98" id="srcline98"> 98</a></span><span class="line">                <span class="mxinfo" id="T220:U103"><span class="var type1" id="S3T220U207">previousMessage</span> = <span class="var type1" id="S2T1325U208">Response</span></span>;<span class="comment">%Update history for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,99" id="srcline99"> 99</a></span><span class="line">                <span class="mxinfo" id="T1:U106"><span class="var type1" id="S4T1U211">originNodeID</span> = <span class="mxinfo" id="T1:U108"><span class="mxinfo" id="T1:U109">double(<span class="mxinfo" id="T13:U110"><span class="var type1" id="S2T1325U216">Response</span>(<span class="mxinfo" id="T1:U112"><span class="mxinfo" id="T1:U113">end</span>-<span class="mxinfo" id="T1:U114">2</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U115">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,100" id="srcline100">100</a></span><span class="line">                <span class="mxinfo" id="T1:U116"><span class="var type1" id="S5T1U224">destNodeID</span> = <span class="mxinfo" id="T1:U118"><span class="mxinfo" id="T1:U119">double(<span class="mxinfo" id="T13:U120"><span class="var type1" id="S2T1325U229">Response</span>(<span class="mxinfo" id="T1:U122"><span class="mxinfo" id="T1:U123">end</span>-<span class="mxinfo" id="T1:U124">1</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U125">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,101" id="srcline101">101</a></span><span class="line">                <span class="mxinfo" id="T1325:U126"><span class="var type1" id="S2T1325U237">Response</span> = <span class="mxinfo" id="T87:U128"><span class="string">'Duplicate'</span></span></span>;<span class="comment">%Tell upper layers duplicate</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,102" id="srcline102">102</a></span><span class="line">            <span class="keyword">else</span><span class="comment">%No Dupe</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,103" id="srcline103">103</a></span><span class="line">                <span class="mxinfo" id="T220:U129"><span class="var type1" id="S3T220U242">previousMessage</span> = <span class="var type1" id="S2T1325U243">Response</span></span>;<span class="comment">%Update history for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,104" id="srcline104">104</a></span><span class="line">                <span class="mxinfo" id="T1:U132"><span class="var type1" id="S4T1U246">originNodeID</span> = <span class="mxinfo" id="T1:U134"><span class="mxinfo" id="T1:U135">double(<span class="mxinfo" id="T13:U136"><span class="var type1" id="S2T1325U251">Response</span>(<span class="mxinfo" id="T1:U138"><span class="mxinfo" id="T1:U139">end</span>-<span class="mxinfo" id="T1:U140">2</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U141">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,105" id="srcline105">105</a></span><span class="line">                <span class="mxinfo" id="T1:U142"><span class="var type1" id="S5T1U259">destNodeID</span> = <span class="mxinfo" id="T1:U144"><span class="mxinfo" id="T1:U145">double(<span class="mxinfo" id="T13:U146"><span class="var type1" id="S2T1325U264">Response</span>(<span class="mxinfo" id="T1:U148"><span class="mxinfo" id="T1:U149">end</span>-<span class="mxinfo" id="T1:U150">1</span></span>)</span>)</span>-<span class="mxinfo" id="T1:U151">48</span></span></span>; <span class="comment">%extract node ID and convert char to number</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,106" id="srcline106">106</a></span><span class="line">                <span class="mxinfo" id="T1325:U152"><span class="var type1" id="S2T1325U272">Response</span> = <span class="mxinfo" id="T220:U154"><span class="var type1" id="S2T1325U274">Response</span>(<span class="mxinfo" id="T1:U156">1</span>:<span class="mxinfo" id="T1:U157"><span class="mxinfo" id="T1:U158">end</span>-<span class="mxinfo" id="T1:U159">3</span></span>)</span></span>;<span class="comment">%Remove identifer key and nodeIDs</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,108" id="srcline108">108</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,109" id="srcline109">109</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="147,110" id="srcline110">110</a></span><span class="line">            <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="147,111" id="srcline111">111</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,112" id="srcline112">112</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="147,113" id="srcline113">113</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,115" id="srcline115">115</a></span><span class="line"><span class="comment">% Final check</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,116" id="srcline116">116</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T2:U160"><span class="mxinfo" id="T1:U161">abs(<span class="var type1" id="S5T1U287">destNodeID</span>)</span> &gt; <span class="mxinfo" id="T1:U163">length(<span class="var type1" id="S12T1324U291">tx</span>.offsetTable)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="147,117" id="srcline117">117</a></span><span class="line">    <span class="mxinfo" id="T1:U165"><span class="var type1" id="S5T1U295">destNodeID</span>=<span class="mxinfo" id="T1:U167"><span class="var type1" id="S12T1324U297">tx</span>.nodeNum</span></span>;<span class="comment">% Something went wrong, probably corrupt message, reset to self</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,118" id="srcline118">118</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,119" id="srcline119">119</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,121" id="srcline121">121</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="147,122" id="srcline122">122</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="147,123" id="srcline123">123</a></span><span class="line"></span></span>
</pre>
