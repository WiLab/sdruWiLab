<pre class="code">
<span class="srcline"><span class="lineno"><a href="202,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">BER</span>, <span class="var type1" id="S3T1106U4">estimate</span>, <span class="var type1" id="S4T182U5">RHard</span>] = demodOFDMSubcarriers_sdr( <span class="var type1" id="S5T536U8">R</span>, <span class="var type1" id="S6T1324U9">tx</span>, <span class="mxinfo" id="T1106:U6"><span class="mxinfo" id="T1106:U7"><span class="var type1" id="S3T1106U10">estimate</span></span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="202,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% demodOFDMSubcarriers: Hard demodulate then compare received and</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% transmitted data</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="202,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Demodulate subcarrier data</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T534:U9"><span class="var type1" id="S7T534U13">RLinear</span> = <span class="mxinfo" id="T534:U11">reshape(<span class="var type1" id="S5T536U16">R</span>,size(<span class="var type1" id="S5T536U20">R</span>,1)*size(<span class="var type1" id="S5T536U24">R</span>,2),1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="202,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T182:U15"><span class="var type1" id="S4T182U29">RHard</span> = <span class="mxinfo" id="T182:U17"><span class="mxinfo" id="T1109:U18"><span class="var type1" id="S7T534U32">RLinear</span>(<span class="mxinfo" id="T1:U20">1</span>:<span class="mxinfo" id="T1:U21"><span class="mxinfo" id="T1:U22">end</span>-<span class="mxinfo" id="T1:U23"><span class="var type1" id="S6T1324U39">tx</span>.padBits</span></span>)</span> &lt; <span class="mxinfo" id="T1:U25">0</span></span></span>; <span class="comment">%Bits</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="202,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Decode received text</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,11" id="srcline11">11</a></span><span class="line"><span class="comment">%estimate.message = OFDMbits2letters(RHard &gt; 0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="202,13" id="srcline13">13</a></span><span class="line"><span class="comment">% Check results (remove CRC for compare)</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,14" id="srcline14">14</a></span><span class="line"><span class="comment">%BER = sum(RHard(1:end-3)~=tx.originalData)/numel(RHard);</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T1:U26"><span class="var type1" id="S2T1U44">BER</span> = <span class="mxinfo" id="T1:U28">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="202,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="202,17" id="srcline17">17</a></span><span class="line"><span class="comment">% Save additional information</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,18" id="srcline18">18</a></span><span class="line"><span class="comment">%estimate.totalFrameErrors(estimate.numProcessed) = sum(RHard~=tx.originalData);</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,19" id="srcline19">19</a></span><span class="line"><span class="comment">%estimate.totalFrameBits(estimate.numProcessed) = numel(RHard);           </span></span></span>
<span class="srcline"><span class="lineno"><a href="202,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="202,21" id="srcline21">21</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="202,22" id="srcline22">22</a></span><span class="line"></span></span>
</pre>
